<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css" />
  <script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.js"></script>
  <link rel="stylesheet" href="/css/toast/app.css" />

<!--제이쿼리-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


  
</head>
<body>
  <header class="header">
    <nav class="navbar">
      <button class="button is-rounded today">Today</button>
      <button class="button is-rounded prev">
        <img src="" alt="">
        <img alt="prev" src="/images/ic-arrow-line-left.png" srcset="/images/ic-arrow-line-left@2x.png 2x, /images/ic-arrow-line-left@3x.png 3x">
      </button>
      <button class="button is-rounded next">
        <img alt="next" src="/images/ic-arrow-line-right.png" srcset="/images/ic-arrow-line-right@2x.png 2x, /images/ic-arrow-line-right@3x.png 3x
          ">
      </button>
      <span class="navbar--range"></span>
    </nav>
  </header>
  <div id="calendar" style="height: 600px;"></div>



  <!-- CDN과 브라우저 환경에서 namespace -->
<script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.ie11.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="../static/scripts/toast/utils.js"></script>

<script>
// import { fetchDailySummaries } from '../static/scripts/data.js'; 


  const Calendar = tui.Calendar;
  const container = document.getElementById('calendar');
  const options = {
  defaultView: 'month',
  timezone: {
    zones: [
      {
        timezoneName: 'Asia/Seoul',
        displayLabel: 'Seoul',
      },
      
    ],
  },
  calendars: [
    {
      id: 'EXPENSE',
      name: 'EXPENSE',
      
    },
    {
      id: 'INCOME',
      name: 'INCOME',
    },
  ],
};

const calendar = new Calendar(container, options);

calendar.setCalendars([
  {
    id: 'EXPENSE',
    name: 'EXPENSE',
    color: '#f20707',
    backgroundColor: '#ffffff',
    borderColor: '#ffffff',
  },
  {
    id: 'INCOME',
    name: 'INCOME',
    color: '#1302fa',
    backgroundColor: '#ffffff',
    borderColor: '#ffffff',
  },
]);


console.log("AJAX 요청 시작");

const url = 'http://localhost:8080/transactions/monthly/2024-09';
let events = [];

$.ajax({
  url: url,
  method: 'GET',
  dataType: 'json',
  success: function(data) {
    console.log('일별 요약 데이터:', data);

    events= data.map((item, index) => {
      return {
        id: `dailySummary${index + 1}`,
        calendarId: item.status,
        title: item.total,
        start: item.date,
        end: item.date,
        category: "allDay"
      };
    });

    console.log(events)

    // AJAX 요청이 성공적으로 완료된 후에 이벤트를 생성합니다.
    console.log("이벤트 생성 시작");
    calendar.createEvents(events);
    console.log("이벤트가 성공적으로 생성되었습니다.");
  },
  error: function(error) {
    console.error('AJAX 오류:', error);
  }
});

console.log("AJAX 요청 끝");


calendar.createEvents();

//날짜 버튼
 const prev=document.querySelector(".prev").addEventListener('click',function(){

 calendar.prev()
displayRenderRange();

 });

 const next=document.querySelector(".next").addEventListener('click',function(){

 calendar.next()
displayRenderRange();

 });

 const today=document.querySelector(".today").addEventListener('click',function(){

 calendar.today()
displayRenderRange();

 });

 const range=document.querySelector(".navbar--range");

 function displayRenderRange() {
    range.textContent = getNavbarRange(calendar.getDateRangeStart(), calendar.getDateRangeEnd(), 'month');
  }

  displayRenderRange();


</script>



</body>
</html>